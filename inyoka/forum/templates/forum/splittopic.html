{#
    forum/splittopic.html
    ~~~~~~~~~~~~~~~~

    This page shows the "splittopic" form. 

    :copyright: (c) 2007-2011 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'forum/page.html' %}
{% do BREADCRUMB.append('Thema aufteilen', topic|url('split'), True) %}
{% do BREADCRUMB.append(topic.title, topic|url, True) %}
{% do BREADCRUMB.append(topic.forum.name, topic.forum|url) %}
{% set scripts = ['jquery.autocomplete'] %}

{% block forum_content %}
  <form action="" method="post" class="new_topic">
    <h2>Thema „{{ topic.title|e }}“ aufteilen</h2>
    <p>
      Mit den Eingabefeldern unten kannst du ein Thema in zwei teilen, indem du entweder die Beiträge manuell auswählst oder ab einem gewählten Beitrag teilst.
    </p>
    <dl>
      <dt>
        <input type="radio" name="action" value="new" id="id_new"{% if form.data.action == 'new' %} checked="checked"{% endif %} />
        <label for="id_new">Neues Topic erstellen</label>
      </dt>
      <dd>
        Forum des neuen Topics: {{ form.forum }}{{ form.errors.forum }}
      </dd>
      <dd>
        Titel des neuen Topics: {{ form.title }}{{ form.errors.title }}
      </dd>
      <dd>
        Version des neuen Topics:
        {{ form.ubuntu_distro }}{{ form.errors.ubuntu_distro }}
        {{ form.ubuntu_version }}{{ form.errors.ubuntu_version }}
      </dd>
      <dt>
        <input type="radio" name="action" value="add" id="id_add"{% if form.data.action == 'add' %} checked="checked" {% endif %} />
        <label for="id_add">An altes Topic anfügen</label>
      </dt>
      <dd>
        Slug des Topics: {{ form.topic }}{{ form.errors.topic }}
      </dd>
    </dl>

    <h3>Vorschau</h3>
    <p>Alle nachfolgenden Beiträge werden abgetrennt</p>

    <table class="topic admin_link_hover">
      <tbody>
       {%- for post in posts %}
      <tr id="post-{{ post.id }}"{% if post.hidden %} class="hidden"{% endif %}>
        <td class="author"
        {%- if post.author_id == USER.id %} style="background-color: #F6F4EF"
        {%- endif %}>
          <p class="username{% if not post.author.is_active %} inactive{% endif %}">
            <a href="{{ post.author|url }}">{{ post.author.username|e }}</a>
            {%- if post.author.primary_group and post.author.primary_group.icon %}
            <img class="teamicon" src="{{ post.author.primary_group.icon_url }}" alt="Teamicon" />
            {%- endif %}
          </p>
          {%- if post.author.member_title %}
          <div class="member_title">{{ post.author.member_title|e }}</div>
          {%- endif %}
          {%- if post.author == topic.author and not loop.first %}
          <div class="member_title">(Threadstarter)</div>
          {%- endif %}
          {%- if post.author.has_avatar and not USER.settings['hide_avatars'] %}
          <img class="avatar" src="{{ post.author.avatar_url }}" alt="Avatar von {{ post.author.username|e }}" />
          {%- endif %}
          <p>Anmeldungsdatum: <br />{{ post.author.date_joined|dateformat }}</p>
          <p>Beiträge: {{ post.author.post_count }}</p>
          {%- if post.author.location %}
          <p>Wohnort: {{ post.author.location|e }}</p>
          {%- endif %}
        </td>
        {%- if post.author_id == USER.id %}
        <td class="post" style="background-color: #F8F6F1">
        {%- else %}
        <td class="post">
        {%- endif %}
          <div class="postinfo">
            <div class="linklist">
            </div>
            <a href="{{ post|url }}" title="Kopiere diesen Link, um auf diesen Beitrag zu verweisen" onclick="alert(this.title + '\n\n' + this.href); return false"><img src="{{ href('static', 'img', 'icon_minipost.gif') }}" alt="Beitrag" /></a>
            Verfasst: {{ post.pub_date|datetimeformat }}
          </div>
          <div class="text">
            {{ post.get_text() }}
          </div>
          {%- set attachments = post.grouped_attachments %}
          {%- if attachments %}
          <hr />
          <dl class="attachments">
          {%- for group, list, class in attachments %}
          {%- if group %}
            <dt>{{ group }}</dt>
            <ul class="attr_list{% if class %} {{ class }}{% endif %}">
            {%- for att in list %}
              <li>{{ att.html_representation }}</li>
            {%- endfor %}
            </ul>
          {%- else %}
          {%- for att in list %}
            <dt>{{ att.name|e }} ({{ att.size|filesizeformat(true) }})</dt>
            {%- if att.comment %}
            <dd class="comment">{{ att.comment|e }}</dd>
            {%- endif %}
            <dd>{{ att.html_representation }}</dd>
          {%- endfor %}
          {%- endif %}
          {%- endfor %}
          </dl>
          {%- endif %}
          {%- if post.author.signature and not USER.settings['hide_signatures'] %}
            <div class="signature">
            {{ post.author.rendered_signature }}
            </div>
          {%- endif %}
        </td>
      </tr>
    {%- endfor %}
    </tbody>
  </table>
  <input type="submit" name="split" value="Beiträge abtrennen" />
  </form>
{% endblock %}

{% block additional_scripts %}
  {{ super() }}
  <script type="text/javascript">
    /* <![CDATA[ */
    (function () {
      $('#id_topic').autocomplete('/?__service__=forum.get_topic_autocompletion', {
        delay: 40, cacheLength: 10});
    })();
    /* ]]> */
  </script>
{% endblock %}
