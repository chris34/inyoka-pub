{#
    forum/edit.m.html
    ~~~~~~~~~~~~~~~

    This page shows displays a formular where the user can create either
    create a new thread or write / edit a post.

    :copyright: (c) 2007-2011 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.

#}
{% extends 'forum/page.m.html' %}

{% if topic %}
  {% set back = topic|url %}
{% else %}
  {% set back = forum|url %}
{% endif %}

{% block content %}
  <form action="" method="post" enctype="multipart/form-data">
    {%- if topic %}
      <h2><a href="{{ topic|url }}">{{ topic.title|e }}</a></h2>
      {%- if post %}
        <h3>Beitrag bearbeiten</h3>
      {%- else %}
        <h3>Neue Antwort</h3>
      {%- endif %}
      {%- if topic.get_version_info() and not (isfirstpost or isnewtopic) %}
        <p class="ubuntu_version">
          <small><strong>Ubuntu-Version:</strong> {{ topic.get_version_info() }}</small>
        </p>
      {%- endif %}
      {%- if discussions %}
        <div class="topic_box discussion_info">
          Dieses Thema ist die Diskussion
          {%- if discussions|count == 1 %} des Artikels
          {%- else %} der Artikel
          {%- endif %}
          {%- for article in discussions %}
          <strong><a href="{{ article|url }}">{{ article.name|e }}</a></strong>
          {%- if not loop.last %},{% endif %}
          {%- endfor %}.
        </div>
      {%- endif %}
    {%- else %}
      <h2><a href="{{ forum|url }}">{{ forum.name|e }}</a></h2>
      <h3>Neues Thema</h3>
    {%- endif %}
    {% if isnewtopic or isfirstpost %}
      <div>
        <strong>Titel</strong> {{ form.title }}{{ form.errors.title }}
        <p class="version_chooser">
          {{ form.ubuntu_distro }}{{ form.errors.ubuntu_distro }}
          {{ form.ubuntu_version }}{{ form.errors.ubuntu_version }}
          <span id="version_info"></span>
        </p>
      </div>
    {% endif %}
    <div>
      <textarea id="id_text" rows="10" name="text">
        {%- if form.data.text -%}
          {{ form.data.text|e }}
        {%- elif form.initial.text != none -%}
          {{ form.initial.text|e }}
        {%- endif -%}
      </textarea>
    </div>
    {{ form.errors.__all__ }}
    <div>
      <input type="submit" value="Vorschau" name="preview" />
      <input type="submit" value="VerÃ¶ffentlichen" name="send" />
      <input type="submit" value="Abbrechen" name="cancel" />
    </div>
  </form>
  {% if preview %}
    <div class="preview_wrapper">
      <h2 class="title">Vorschau</h2>
      <div class="preview">{{ preview }}</div>
    </div>
  {% endif %}
{% endblock %}
