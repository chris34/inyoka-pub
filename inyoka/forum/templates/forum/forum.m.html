{#
    forum/forum.m.html
    ~~~~~~~~~~~~~~~~

    This template shows a forum with all subforums and topics inside.

    :copyright: (c) 2007-2012 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'forum/page.m.html' %}
{% from 'forum/_forum.html' import generate_subscription_link with context %}

{% set back = forum.parent|url %}

{% block content %}
  <h2>{{ forum.name }}</h2>
  {% if subforums %}
    <h3>{% trans %}Subforums{% endtrans %}</h3>
    <div class="forums">
      {%- for subforum in subforums %}
        <a href="{{ subforum|url }}"><div class="button">{{ subforum.name }}</div></a>
      {%- endfor %}
    </div>
  {% endif %}
  {{ pagination.generate() }}
  {# TODO: workaround for topics without first or last_post to not mess up with server errors #}
  <div class="topics">
    <h3>{% trans %}Topics{% endtrans %}</h3>
    {%- for topic in topics if (topic.first_post and topic.last_post) %}
      <a class="first_unread" href="{{ topic|url('first_unread') }}">
        <img src="{{ href('static', 'img/forum/goto.m.png') }}" />
      </a>
      <a href="{{ topic|url }}">{#
        #}<div class="button
            {% if not topic.get_read_status(USER) %} unread{% endif %}
            {% if topic.solved %} solved{% endif %}
            {% if topic.hidden %} hidden{% endif %}
            {% if can_moderate and topic.reported %} reported{% endif %}
            {% if topic.sticky %} sticky{% endif %}
            {% if topic.has_poll %} poll{% endif %}
            {% if topic.locked %} locked{% endif %}">
        {%- if topic.sticky %}<strong>{% trans %}Sticky:{% endtrans %}</strong>{% endif -%}
          {{ topic.title|e -}}
        </div>{#
      #}</a>
    {%- endfor %}
  </div>
  {{ pagination.generate() }}
  <section class="actions">
    <a href="{{ forum|url('newtopic') }}">{% trans %}New topic{% endtrans %}</a>
    {% if is_subscribed %}
      <a href="{{ generate_subscription_link(do='unsubscribe') }}">
        <span>{% trans %}Unsubscribe{% endtrans %}</span>
      </a>
    {% else %}
      <a href="{{ generate_subscription_link() }}">
        <span>{% trans %}Subscribe{% endtrans %}</span>
      </a>
    {% endif %}
  </section>
{% endblock %}
