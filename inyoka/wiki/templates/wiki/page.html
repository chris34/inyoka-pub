{#
    wiki/page.html
    ~~~~~~~~~~~~~~

    This is the base layout for all wiki detail pages except of partial
    templates (prefixed with an underscore)

    :copyright: (c) 2007-2011 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'overall.html' %}

{%- if page %}
  {# XXX may not work always #}
  {% for part in page.title.split('/') %}
    {%- if loop.first %}
      {% set link = href('wiki', part) %}
    {%- else %}
      {% set link = '%s/%s' % (link, part) %}
    {%- endif %}
    {% do BREADCRUMB.append(part, link, True, 0) %}
  {% endfor %}
{%- endif %}
{% do BREADCRUMB.append('Wiki', href('wiki'), True) %}
{% set styles = styles|default([]) + ['wiki', 'highlight'] %}
{% set active_app = 'wiki' %}
{% set navi_type  = 'tabbar' %}

{% block pathbar_extensions %}
  <div class="dropdown">
    <ul class="dropdown"><li><a href="{{ href('portal', 'search') }}">Erweiterte Suche</a></li><li><ul>
      <li><a href="{{ href('wiki', 'Wiki', 'Letzte Änderungen') }}">Letzte Änderungen</a></li>
      <li><a href="{{ href('wiki', 'Wiki', 'Tags') }}">Tag-Wolke</a></li>
    </ul></li></ul>
  </div>
{% endblock %}

{% block tabbar %}
  {%- if can and can.read %}
    <ul>
      {%- for action_, title in (
        ('show', 'Artikel'),
        ('edit', 'Bearbeiten'),
        ('log', 'Versionen'),
        ('backlinks', 'Backlinks'),
        ('manage', 'Weitere Aktionen')
      ) %}
        {%- if action_ != 'edit' or (action_ == 'edit' and (can.edit or USER.is_anonymous)) %}
        <li><a href="{{ page|url(action_) }}"{% if action == action_ %} class="active"{% endif %}>{{ title }}</a></li>
        {%- endif %}
      {%- endfor %}
      <li{% if not page.topic %} class="disabled"{% endif %}><a href="{{ page.topic and page.topic|url or href('forum', 'new_discussion', page.title) }}">Diskussion</a></li>
      {%- if is_subscribed %}
        <li><a href="{{ page|url('unsubscribe') }}">Abbestellen</a></li>
      {%- else %}
        <li><a href="{{ page|url('subscribe') }}">Abonnieren</a></li>
      {%- endif %}
    </ul>
  {%- endif %}
{% endblock %}

{% block content %}
  {%- block wiki_content %}

  {%- endblock %}
{%- endblock %}
